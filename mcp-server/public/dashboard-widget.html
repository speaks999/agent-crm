<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Dashboard</title>
    <style>
      :root {
        color: #0b0b0f;
        font-family: "Inter", system-ui, -apple-system, sans-serif;
      }

      html,
      body {
        width: 100%;
        min-height: 100%;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        padding: 16px;
        background: #f6f8fb;
      }

      main {
        width: 100%;
        max-width: 800px;
        min-height: 400px;
        margin: 0 auto;
        background: #fff;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.08);
      }

      h2 {
        margin: 0 0 20px;
        font-size: 1.25rem;
        font-weight: 600;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: #f2f4fb;
        border-radius: 12px;
        padding: 16px;
        text-align: center;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #111bf5;
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 0.85rem;
        color: #6c768a;
      }

      .section {
        margin-bottom: 24px;
      }

      .section-title {
        font-weight: 600;
        margin-bottom: 12px;
        font-size: 1rem;
      }

      .recent-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .recent-item {
        background: #f2f4fb;
        border-radius: 8px;
        padding: 10px 12px;
        font-size: 0.9rem;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6c768a;
      }
    </style>
  </head>
  <body>
    <main>
      <h2>CRM Dashboard</h2>
      <div class="stats-grid" id="stats-grid"></div>
      <div class="section">
        <div class="section-title">Recent Activity</div>
        <ul class="recent-list" id="recent-list"></ul>
      </div>
    </main>

    <script type="module">
      const statsGrid = document.querySelector("#stats-grid");
      const recentList = document.querySelector("#recent-list");

      let dashboardData = window.openai?.toolOutput?.dashboard ?? {
        accounts: 0,
        contacts: 0,
        deals: 0,
        openDeals: 0,
        recentActivity: [],
      };

      const render = () => {
        // Render stats
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-value">${dashboardData.accounts || 0}</div>
            <div class="stat-label">Accounts</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${dashboardData.contacts || 0}</div>
            <div class="stat-label">Contacts</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${dashboardData.deals || 0}</div>
            <div class="stat-label">Total Deals</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${dashboardData.openDeals || 0}</div>
            <div class="stat-label">Open Deals</div>
          </div>
        `;

        // Render recent activity
        recentList.innerHTML = "";
        if (!dashboardData.recentActivity || dashboardData.recentActivity.length === 0) {
          recentList.innerHTML = '<li class="empty-state">No recent activity</li>';
          return;
        }

        dashboardData.recentActivity.slice(0, 5).forEach((activity) => {
          const li = document.createElement("li");
          li.className = "recent-item";
          li.textContent = activity;
          recentList.appendChild(li);
        });
      };

      const handleSetGlobals = (event) => {
        const globals = event.detail?.globals;
        if (!globals?.toolOutput?.dashboard) return;
        dashboardData = globals.toolOutput.dashboard;
        render();
      };

      window.addEventListener("openai:set_globals", handleSetGlobals, {
        passive: true,
      });

      // Initial render
      render();
    </script>
  </body>
</html>

